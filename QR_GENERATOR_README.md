# WhatsApp QR Code Generator

This project provides multiple ways to generate QR codes for WhatsApp sessions, making it easy to connect your WhatsApp account to the API.

## üöÄ Features

- **Multiple Script Options**: PowerShell (Windows) and Bash (Linux/macOS) scripts
- **Session Management**: Create, list, and manage WhatsApp sessions
- **QR Code Generation**: Generate QR codes from existing sessions or custom strings
- **Multiple Formats**: Support for PNG and SVG output formats
- **Customizable Output**: Control size, margin, and output directory
- **Auto-timestamping**: Automatic timestamp addition to prevent filename conflicts

## üìã Prerequisites

- **Node.js** (v14 or higher)
- **npm** packages installed (`npm install`)
- **WhatsApp API** running on your server
- **curl** (for shell script) or **PowerShell** (for Windows script)
- **jq** (optional, for better JSON parsing in shell script)

## üõ†Ô∏è Installation

1. Ensure all dependencies are installed:
```bash
npm install
```

2. Make sure your WhatsApp API is running on the configured server.

3. Make the shell script executable (Linux/macOS):
```bash
chmod +x qr-generator.sh
```

## üìñ Usage

### Shell Script (Recommended for Linux/macOS)

#### Basic Commands

```bash
# List all WhatsApp sessions
./qr-generator.sh list-sessions

# Generate QR code from existing session
./qr-generator.sh generate <session_id>

# Create new session with custom ID and generate QR code
./qr-generator.sh create <phone_number> <session_id>

# Create new session with auto-generated ID and generate QR code
./qr-generator.sh create-auto <phone_number>

# Generate QR code from a QR string
./qr-generator.sh from-string "<qr_string>"

# Show help
./qr-generator.sh help
```

#### Phone Number Format
‚ö†Ô∏è **Important**: Use phone numbers WITHOUT the '+' prefix
- ‚úÖ **Correct**: `6285168671319`
- ‚ùå **Incorrect**: `+6285168671319`

#### Advanced Options

```bash
# Custom output file
./qr-generator.sh generate felix_main --output my-qr.png

# SVG format with custom size
./qr-generator.sh create-auto 6285168671319 --format svg --size 1024

# Custom directory and no timestamp
./qr-generator.sh generate session123 --dir ./my-qr-codes --no-timestamp

# Custom margin
./qr-generator.sh create 6285168671319 felix_id --margin 4
```

### PowerShell Script (Windows)

#### Basic Commands

```powershell
# List all WhatsApp sessions
.\qr-generator.ps1 list-sessions

# Generate QR code from existing session
.\qr-generator.ps1 generate <session_id>

# Create new session with custom ID and generate QR code
.\qr-generator.ps1 create <phone_number> <session_id>

# Create new session with auto-generated ID and generate QR code
.\qr-generator.ps1 create-auto <phone_number>

# Generate QR code from a QR string
.\qr-generator.ps1 from-string "<qr_string>"

# Show help
.\qr-generator.ps1 help
```

#### Advanced Options

```powershell
# Custom output file
.\qr-generator.ps1 generate felix_main -Output my-qr.png

# SVG format with custom size
.\qr-generator.ps1 create-auto 6285168671319 -Format svg -Size 1024

# Custom directory and no timestamp
.\qr-generator.ps1 generate session123 -Dir ./my-qr-codes -NoTimestamp

# Custom margin
.\qr-generator.ps1 create 6285168671319 felix_id -Margin 4
```

### Direct Node.js Script

You can also use the Node.js script directly:

#### Basic Usage
```bash
node generate-qr-image.js "<qr_string>" "output.png"
```

#### Examples
```bash
# Basic PNG generation
node generate-qr-image.js "2@ABC123..." "whatsapp-qr.png"

# Custom filename with timestamp
node generate-qr-image.js "2@ABC123..." "whatsapp-qr-$(date +%Y%m%d_%H%M%S).png"

# SVG format
node generate-qr-image.js "2@ABC123..." "whatsapp-qr.svg" "svg"

# Custom size and margin
node generate-qr-image.js "2@ABC123..." "whatsapp-qr.png" "png" 1024 4
```

## üîß PowerShell Integration

### Generate QR Code from API

```powershell
# Get QR code from API and generate image
$response = Invoke-RestMethod -Uri "http://34.121.26.54:3000/api/sessions/felix_main/qr" -Method GET
$qrCode = $response.qrCode
node generate-qr-image.js $qrCode "whatsapp-qr-felix.png"
```

## üìù Complete Manual Workflow

### Step 1: Create a WhatsApp Session
```bash
# Using curl (Linux/macOS)
curl -X POST http://34.121.26.54:3000/api/sessions \
  -H "Content-Type: application/json" \
  -d '{"userId":"felix_indonesia","phoneNumber":"6285168671319"}'

# Using PowerShell (Windows)
$body = @{
    userId = "felix_indonesia"
    phoneNumber = "6285168671319"
} | ConvertTo-Json

Invoke-RestMethod -Uri "http://34.121.26.54:3000/api/sessions" -Method POST -Body $body -ContentType "application/json"
```

### Step 2: Wait for QR Code Generation
Wait 5-10 seconds for the QR code to be generated by the WhatsApp service.

### Step 3: Retrieve QR Code
```bash
# Using curl (Linux/macOS)
curl http://34.121.26.54:3000/api/sessions/felix_indonesia/qr

# Using PowerShell (Windows)
Invoke-RestMethod -Uri "http://34.121.26.54:3000/api/sessions/felix_indonesia/qr" -Method GET
```

### Step 4: Generate QR Code Image
```bash
node generate-qr-image.js "<qr_code_string>" "whatsapp-qr-felix.png"
```

## üìÅ Output Files

### File Types
- **PNG**: Default format, good for most uses
- **SVG**: Vector format, scalable and smaller file size

### File Locations
- Default directory: `./qr-codes/`
- Filename format: `whatsapp-qr-<session_id>-<timestamp>.<format>`
- Example: `whatsapp-qr-felix_main-20241020_143022.png`

### File Naming Options
- **With timestamp** (default): `whatsapp-qr-session123-20241020_143022.png`
- **Without timestamp**: `whatsapp-qr-session123.png`
- **Custom filename**: Use `--output` or `-Output` parameter

## üîç Troubleshooting

### Common Issues

1. **"QR code not available"**
   - Wait longer (10-15 seconds) after creating a session
   - Check if the session exists: `./qr-generator.sh list-sessions`
   - Try creating a new session

2. **"Node.js not found"**
   - Install Node.js from https://nodejs.org/
   - Ensure Node.js is in your PATH

3. **"generate-qr-image.js not found"**
   - Run the script from the project root directory
   - Ensure the file exists in the current directory

4. **"npm packages not installed"**
   - Run `npm install` in the project directory

5. **Phone number format error**
   - Remove the '+' prefix from phone numbers
   - Use format: `6285168671319` instead of `+6285168671319`

### Debug Mode

For shell script, you can enable debug mode:
```bash
bash -x ./qr-generator.sh create-auto 6285168671319
```

For PowerShell script:
```powershell
$VerbosePreference = "Continue"
.\qr-generator.ps1 create-auto 6285168671319
```

## üìä Examples

### Generate QR Code for Existing Session
```bash
./qr-generator.sh generate felix_main
```

### Create New Session and Generate QR Code
```bash
./qr-generator.sh create 6285168671319 felix_indonesia
```

### Auto-Generated Session ID
```bash
./qr-generator.sh create-auto 6285168671319
```

### Custom Output with SVG Format
```bash
./qr-generator.sh generate felix_main --output custom-qr.svg --format svg --size 1024
```

### Generate QR Code from String
```bash
./qr-generator.sh from-string "2@ABC123DEF456..." --output manual-qr.png
```

### List All Sessions
```bash
./qr-generator.sh list-sessions
```

## üîó API Endpoints

The scripts interact with these API endpoints:

- **GET** `/api/sessions` - List all sessions
- **POST** `/api/sessions` - Create new session
- **GET** `/api/sessions/{sessionId}/qr` - Get QR code for session

## üìÑ License

This project is part of the WhatsApp API integration system. Use according to your project's license terms.

## ü§ù Contributing

1. Fork the repository
2. Create your feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## üìû Support

If you encounter issues:
1. Check the troubleshooting section
2. Verify your API server is running
3. Ensure all dependencies are installed
4. Check the logs for detailed error messages